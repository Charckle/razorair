{% extends "main_page_module/base.html" %}

{% block extraheader %}
{% endblock extraheader  %}

{% block nav_sett %}text-secondary{% endblock nav_sett %}

{% block content%}

  <div class="container-fluid">
    <br>
    <div class="row">
      <div class="col-sm-1"></div>
      <div class="col-sm-10">
        
        <h4>Weather Settings</h4>
        <hr>
        
        <!-- Current Location -->
        <form method="POST" action="{{ url_for('main_page_module.settings_edit') }}" accept-charset="UTF-8" role="form">
          {{ form.csrf_token }}
          
          <h5>Current Location (Home Weather)</h5>
          <p class="text-muted">This location's weather will be displayed in the top section and used for hourly weather.</p>
          
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="current_location_latitude" class="form-label">Latitude</label>
              {{ form.current_location_latitude(class="form-control") }}
            </div>
            <div class="col-md-4">
              <label for="current_location_longitude" class="form-label">Longitude</label>
              {{ form.current_location_longitude(class="form-control") }}
            </div>
          </div>
          
          <hr>
          
          <h5>Temperature Warning Thresholds</h5>
          <p class="text-muted">Set temperature thresholds for warnings. Warnings will appear if temperatures exceed these values in the next 24 hours.</p>
          
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="high_temp_threshold" class="form-label">High Temperature Threshold (°C)</label>
              {{ form.high_temp_threshold(class="form-control") }}
              <small class="form-text text-muted">Warning if temperature exceeds this value.</small>
            </div>
            <div class="col-md-4">
              <label for="low_temp_threshold" class="form-label">Low Temperature Threshold (°C)</label>
              {{ form.low_temp_threshold(class="form-control") }}
              <small class="form-text text-muted">Warning if temperature falls below this value.</small>
            </div>
          </div>
          
          <hr>
          
          <h5>Shelly Thermostat Settings</h5>
          <p class="text-muted">Configuration for Shelly thermostat communication.</p>
          
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="shelly_thermostat_ip" class="form-label">Shelly Thermostat IP Address</label>
              {{ form.shelly_thermostat_ip(class="form-control") }}
              <small class="form-text text-muted">IP address of the Shelly thermostat device (e.g., 192.168.0.123).</small>
            </div>
            <div class="col-md-6">
              <label for="shelly_src_id" class="form-label">Shelly Source ID</label>
              {{ form.shelly_src_id(class="form-control") }}
              <small class="form-text text-muted">Source identifier for Shelly device communication (UUID format).</small>
            </div>
          </div>
          
          <div class="form-group">
            {{ form.submit(class="btn btn-primary mb-3") }}
          </div>
        </form>
        
        <hr>
        
        <!-- Cities List -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5>Weather Cities</h5>
          <a href="{{ url_for('main_page_module.settings_city_new') }}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Add City
          </a>
        </div>
        <p class="text-muted">Cities shown in the daily weather forecast.</p>
        
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Name</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for city in cities %}
              <tr>
                <td><strong>{{ city.name }}</strong></td>
                <td>{{ city.latitude }}</td>
                <td>{{ city.longitude }}</td>
                <td>
                  <a href="{{ url_for('main_page_module.settings_city_edit', city_index=loop.index0) }}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-pencil"></i> Edit
                  </a>
                  <a href="{{ url_for('main_page_module.settings_city_delete', city_index=loop.index0) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this city?');">
                    <i class="bi bi-trash"></i> Delete
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
      <div class="col-sm-1"></div>
    </div>
  </div>

{% endblock content %}
